# 🏗️ Tower Blocks | 堆塔游戏

3D方块堆叠游戏！精准放置，挑战完美对齐，建造最高的塔！

## 📖 游戏简介

Tower Blocks（堆塔游戏）是一款基于 Three.js 的 3D 方块堆叠游戏。玩家需要在移动的方块上精准地放置新方块，未对齐的部分会被切掉，剩余部分继续堆叠。如果方块完全没有重叠，游戏结束。游戏简单易上手，但要达到高分需要极高的精准度和时机把握。支持完美对齐奖励，速度逐渐加快，挑战你的反应能力和专注力！

### 游戏特色
- **3D 视觉**：Three.js 渲染的精美 3D 场景
- **流畅动画**：GSAP 驱动的平滑动画效果
- **完美对齐**：精准对齐可保持方块完整
- **动态切割**：未对齐部分真实物理掉落
- **难度递增**：速度随楼层高度逐渐加快
- **最高分记录**：本地保存挑战记录
- **多种控制**：支持点击、空格、触摸
- **响应式设计**：适配各种设备

## 🎮 游戏玩法

### 基本操作

**控制方式**：
- **鼠标点击**：点击屏幕任意位置放置方块
- **空格键**：按空格键放置方块
- **触摸屏**：触摸屏幕放置方块

**按钮控制**：
- **开始游戏**：点击"开始游戏"按钮
- **再玩一次**：游戏结束后点击"再玩一次"
- **游戏规则**：点击右上角"游戏规则"查看详情

### 游戏规则

#### 核心目标
- **堆叠方块**：尽可能堆叠更多层方块
- **建造高塔**：挑战最高楼层记录
- **完美对齐**：追求完美放置

#### 游戏机制

**方块移动**：
- 方块在 X 轴或 Z 轴上左右移动
- 奇数层（1、3、5...）：X 轴移动（左右）
- 偶数层（2、4、6...）：Z 轴移动（前后）
- 移动范围：±12 单位
- 到达边界后自动反向

**方块放置**：
1. 点击/按空格放置移动中的方块
2. 计算与下层方块的重叠部分
3. 重叠部分保留，继续堆叠
4. 未重叠部分被切掉并掉落

**完美对齐**：
- **判定阈值**：重叠差小于 0.3 单位
- **奖励效果**：
  - 方块不被切割
  - 完全保持原尺寸
  - 位置自动对齐到下层中心
- **完美标志**：获得完美对齐时无切割动画

**方块切割**：
- **切割条件**：方块与下层未完美对齐
- **切割逻辑**：
  - 计算重叠长度
  - 保留重叠部分作为新底座
  - 切掉未重叠部分
- **掉落动画**：
  - 切掉的部分向下掉落
  - 带有旋转动画
  - 横向飞出（根据方向）

#### 失败条件
- **完全无重叠**：新方块与下层完全没有重叠
- **状态标记**：方块状态变为 MISSED
- **游戏结束**：显示游戏结束界面

#### 难度递增

**速度计算**：
```
基础速度 = -0.1
关卡系数 = index × 0.005
当前速度 = -0.1 - (层数 × 0.005)
最快速度 = -4
```

**速度示例**：
| 楼层 | 速度 | 说明 |
|------|------|------|
| 1 | -0.1 | 初始速度（慢） |
| 10 | -0.15 | 稍快 |
| 50 | -0.35 | 中速 |
| 100 | -0.6 | 较快 |
| 780+ | -4.0 | 最快（封顶） |

#### 计分系统

**分数规则**：
- 每成功放置1层：**+1 分**
- 分数 = 楼层数 - 1（第一层为底座不计分）
- 实时显示当前楼层数

**最高分**：
- 自动保存到本地存储（localStorage）
- 键名：`towerBlocksHighScore`
- 实时更新显示
- 游戏结束后保留

#### 视觉效果

**方块颜色**：
- 基于楼层数和随机偏移生成
- 使用正弦函数计算 RGB 值
- 颜色公式：
  ```
  offset = index + colorOffset
  R = sin(0.3 × offset) × 55 + 200
  G = sin(0.3 × offset + 2) × 55 + 200
  B = sin(0.3 × offset + 4) × 55 + 200
  ```
- 每层颜色平滑渐变

**相机跟随**：
- 相机高度：楼层数 × 2 + 4
- 相机位置：(2, y, 2)
- 正交投影，保持等距视角
- 平滑过渡（0.3秒）

**掉落动画**：
- 向下掉落：-30 单位
- 横向飞出：±40 单位（根据方向）
- 随机旋转：±10 弧度
- 动画时长：1 秒

### 游戏流程

1. **准备阶段**：
   - 显示游戏开始界面
   - 查看快速提示
   - 点击"开始游戏"

2. **开始游戏**：
   - 第一个方块（底座）固定不动
   - 第二个方块开始移动
   - 操作提示显示

3. **放置方块**：
   - 观察方块移动
   - 找准时机点击/按空格
   - 方块落下并切割

4. **持续堆叠**：
   - 新方块自动生成
   - 速度逐渐加快
   - 楼层不断增高

5. **追求完美**：
   - 尝试完美对齐
   - 避免方块变小
   - 保持稳定堆叠

6. **游戏结束**：
   - 方块完全无重叠
   - 显示最终楼层数
   - 查看最高分记录

## 🖥️ 界面说明

### 游戏头部
- **游戏标题**：🏗️ Tower Blocks Game
- **游戏规则按钮**：查看详细规则（右上角）

### 3D 游戏场景

**场景设置**：
- 渲染器：WebGL
- 相机类型：正交相机
- 背景颜色：#D0CBC7（浅灰色）
- 光源：
  - 定向光（DirectionalLight）：白色，强度 0.5
  - 环境光（AmbientLight）：白色，强度 0.4

**方块渲染**：
- 材质：MeshToonMaterial（卡通着色）
- 着色模式：FlatShading（平面着色）
- 尺寸：
  - 初始宽度：10 单位
  - 初始高度：2 单位
  - 初始深度：10 单位

### 分数显示区

**位置**：顶部中央（悬浮卡片）

**内容**：
1. **楼层标签**：
   - 图标：🏗️
   - 文字："楼层"

2. **当前分数**：
   - 超大数字显示（3-6rem）
   - 紫色（#667eea）
   - 实时更新

3. **最高分**：
   - 图标：🏆
   - 文字："最高: X"
   - 金色图标

**显示状态**：
- 准备阶段：隐藏（上方）
- 游戏中：显示（平滑下滑）
- 游戏结束：缩小显示

### 操作提示

**位置**：分数下方

**内容**：
- 图标：👆
- 文字："点击屏幕或按空格键放置方块"
- 白色圆角卡片

**显示逻辑**：
- 游戏开始时显示
- 第5层后自动隐藏
- 淡入淡出动画

### 游戏开始界面

**全屏居中显示**：

**主要内容**：
1. **游戏 Logo**：
   - 图标：🏗️（4rem）
   - 标题："Tower Blocks"（Fredoka One 字体）
   - 紫色主题

2. **游戏副标题**：
   - "堆叠方块，建造最高的塔！"

3. **开始按钮**：
   - 图标：▶️
   - 文字："开始游戏"
   - 紫色渐变背景
   - 悬停放大效果

4. **快速提示**：
   - 图标：💡
   - 3条提示：
     - ✓ 完美对齐可获得奖励
     - ✓ 速度会逐渐加快
     - ✓ 挑战你的最高记录
   - 浅紫色背景框

**动画效果**：
- 所有元素淡入 + 上浮
- 平滑过渡动画

### 游戏结束界面

**全屏居中显示**：

**主要内容**：
1. **游戏结束图标**：
   - 100×100px 圆形
   - 渐变背景
   - 🏗️ 图标

2. **标题**：
   - "游戏结束！"（2.5rem）

3. **最终分数**：
   - "你建造了 X 层高楼"
   - 分数数字紫色强调（1.5rem）

4. **鼓励文字**：
   - "继续努力，挑战更高！"

5. **再玩一次按钮**：
   - 图标：🔄
   - 文字："再玩一次"
   - 紫色渐变背景

**动画效果**：
- 淡入 + 上浮动画
- 分层延迟显示

### 规则侧边栏

**显示方式**：从左侧滑入（400px 宽）

**背景**：深色半透明（rgba(26, 32, 44, 0.98)）

**关闭按钮**：
- 右上角圆形按钮
- × 图标
- 悬停旋转 90 度

**规则内容**（5个卡片）：

1. **🎮 游戏目标**：
   - 堆叠尽可能多的方块，建造最高的塔

2. **🖱️ 操作方式**：
   - 点击屏幕或按空格键放置移动中的方块

3. **🎯 完美对齐**：
   - 如果方块完美对齐，将不会被切割
   - 获得完美对齐奖励！

4. **✂️ 方块切割**：
   - 未对齐的部分会被切掉
   - 剩余部分继续堆叠

5. **⚠️ 游戏结束**：
   - 如果方块完全没有重叠，游戏结束
   - 挑战你的最高分！

**卡片样式**：
- 白色半透明背景
- 圆角卡片
- 图标 + 标题 + 说明

## 🎨 视觉效果

### 配色方案
- **主色调**：紫色渐变（#667eea → #764ba2）
- **次色调**：粉红渐变（#f093fb → #f5576c）
- **成功色**：青蓝渐变（#4facfe → #00f2fe）
- **警告色**：粉黄渐变（#fa709a → #fee140）
- **背景**：白色（#ffffff）
- **3D背景**：浅灰（#D0CBC7）
- **方块颜色**：动态渐变（基于 sin 函数）

### 动画效果

1. **方块移动**：左右/前后来回移动
2. **切割掉落**：切掉部分向下 + 横向 + 旋转
3. **相机跟随**：平滑上升（0.3秒）
4. **分数浮现**：从上方滑下
5. **界面淡入**：元素逐个淡入 + 上浮
6. **按钮悬停**：放大 + 阴影增强
7. **重启动画**：方块缩小 + 旋转消失

### 特殊效果
- **毛玻璃**：backdrop-filter 模糊效果
- **渐变背景**：多种渐变色组合
- **阴影层次**：多级 box-shadow
- **平滑过渡**：cubic-bezier 缓动
- **3D 光照**：定向光 + 环境光
- **卡通着色**：MeshToonMaterial

## 📱 响应式支持

### 桌面设备（> 768px）
- 完整游戏界面
- 大号分数显示（6rem）
- 规则侧边栏 400px 宽
- 完整按钮文字

### 移动设备（≤ 768px）
- 游戏场景自适应
- 分数显示 3rem
- 规则侧边栏全屏宽
- 头部按钮仅显示图标
- 卡片内边距缩小
- 触摸屏优化

## 🚀 快速开始

### 运行游戏
1. 在浏览器中打开 `index.html`
2. 点击"开始游戏"
3. 点击屏幕或按空格放置方块！

### 外部依赖
- **Three.js r83**：3D 渲染引擎（CDN）
- **GSAP (TweenMax)**：动画库（CDN）
- **Google Fonts**：Poppins、Fredoka One
- **Font Awesome 6.4.0**：图标库（CDN）

### 浏览器要求
- ✅ 支持 WebGL
- ✅ 支持 ES6 语法
- ✅ 支持 requestAnimationFrame
- ✅ 支持 localStorage
- ✅ Chrome / Edge（推荐）
- ✅ Firefox
- ✅ Safari

## 💡 游戏技巧

### 新手技巧
1. **观察节奏**：先观察几秒钟方块移动节奏
2. **中心放置**：初期尽量放在中心位置
3. **不要急**：慢慢来，不要急于点击
4. **视觉参考**：利用下层方块作为参考
5. **放松心态**：保持放松，不要紧张

### 进阶技巧
1. **完美对齐**：追求完美对齐保持尺寸
2. **预判速度**：提前预判加速后的节奏
3. **边缘控制**：在方块接近边缘时点击
4. **专注力**：保持专注，不被干扰
5. **肌肉记忆**：培养点击时机的肌肉记忆

### 高手技巧
1. **极限对齐**：连续追求完美对齐
2. **速度适应**：快速适应速度变化
3. **余光观察**：用余光观察而非盯着看
4. **心流状态**：进入心流状态自然反应
5. **长时专注**：保持长时间高度专注

### 高分策略
1. **完美开局**：前10层尽量完美对齐
2. **稳定堆叠**：避免方块变小
3. **适应加速**：适应速度后保持节奏
4. **心理建设**：高分时保持冷静
5. **坚持到底**：即使失误也要坚持

## 🏆 挑战目标

### 分数挑战
- 🥉 **新手**：达到 10 层
- 🥈 **入门**：达到 20 层
- 🥇 **熟练**：达到 50 层
- 💎 **高手**：达到 100 层
- 👑 **大师**：达到 200 层
- 🌟 **传奇**：达到 500+ 层

### 特殊挑战
- 🎯 **完美主义**：连续 10 次完美对齐
- ⚡ **速度之王**：在最快速度下坚持 50 层
- 💯 **稳定王者**：100 层内不失误
- 🔥 **极限挑战**：单局 1000+ 层

### 成就系统
- 🏗️ **建筑师**：首次达到 50 层
- 🏙️ **城市规划师**：首次达到 100 层
- 🌆 **摩天大楼**：首次达到 200 层
- 🗼 **塔尖传说**：首次达到 500 层

## 📄 文件结构

```
Tower-Blocks/
├── index.html          # 游戏主页面
├── style.css           # 样式表（UI设计、动画）
├── script.js           # 游戏逻辑（3D渲染、物理）
└── README.md           # 本文档
```

## 🔧 技术细节

### Three.js 场景配置
```javascript
场景设置:
  渲染器: WebGLRenderer
  抗锯齿: true
  背景色: #D0CBC7

相机:
  类型: OrthographicCamera（正交相机）
  视野大小: 20
  位置: (2, 2, 2)
  目标: (0, 0, 0)

光源:
  定向光: 颜色=#ffffff, 强度=0.5, 位置=(0,499,0)
  环境光: 颜色=#ffffff, 强度=0.4
```

### 方块类 (Block)
```javascript
属性:
  - dimension: {width, height, depth}
  - position: {x, y, z}
  - state: ACTIVE | STOPPED | MISSED
  - speed: -0.1 - index*0.005 (max: -4)
  - workingPlane: 'x' | 'z' (奇偶交替)

方法:
  - reverseDirection(): 反向移动
  - place(): 放置方块并切割
  - tick(): 更新位置
```

### 游戏类 (Game)
```javascript
状态:
  - LOADING: 加载中
  - READY: 准备开始
  - PLAYING: 游戏进行中
  - ENDED: 游戏结束
  - RESETTING: 重置中

方法:
  - startGame(): 开始游戏
  - placeBlock(): 放置方块
  - addBlock(): 添加新方块
  - endGame(): 游戏结束
  - restartGame(): 重启游戏
```

### 切割算法
```javascript
1. 计算重叠长度:
   overlap = targetWidth - |currentPos - targetPos|

2. 判断完美对齐:
   if (overlap差 < 0.3) {
     bonus = true;
     不切割，完全保留;
   }

3. 切割方块:
   - 保留部分: overlap长度
   - 切掉部分: 原长度 - overlap
   - 调整位置对齐

4. 掉落动画:
   - 向下: -30单位
   - 横向: ±40单位
   - 旋转: 随机
```

### 速度计算
```javascript
speed = -0.1 - (index * 0.005)
if (speed < -4) speed = -4

direction = speed (初始向负方向)
当碰到边界时: direction *= -1
```

### 颜色生成
```javascript
offset = index + randomColorOffset
r = sin(0.3 * offset) * 55 + 200
g = sin(0.3 * offset + 2) * 55 + 200
b = sin(0.3 * offset + 4) * 55 + 200
color = new THREE.Color(r/255, g/255, b/255)
```

### 相机跟随
```javascript
cameraY = blocksLength * 2 + 4
TweenLite.to(camera.position, 0.3, {
  y: cameraY,
  ease: Power1.easeInOut
})
```

## 🐛 反馈与支持

### 常见问题

**Q: 如何获得完美对齐？**  
A: 当方块与下层的位置差小于 0.3 单位时，即判定为完美对齐，方块不会被切割。

**Q: 为什么方块速度越来越快？**  
A: 方块速度随楼层增加而加快，公式为 -0.1 - (层数 × 0.005)，最快 -4。

**Q: 最高分如何保存？**  
A: 最高分自动保存在浏览器的 localStorage 中，清除浏览器数据会丢失。

**Q: 可以暂停游戏吗？**  
A: 目前不支持暂停功能，游戏一旦开始就会持续进行直到失败。

**Q: 为什么有时候方块颜色不同？**  
A: 方块颜色基于楼层数和随机偏移，使用正弦函数生成渐变色。

**Q: 移动设备上如何操作？**  
A: 触摸屏幕任意位置即可放置方块。

**Q: 游戏有关卡限制吗？**  
A: 没有关卡限制，可以无限堆叠，但速度会在第 780 层达到上限。

**Q: 切掉的方块去哪了？**  
A: 切掉的方块会带着旋转动画向下和横向飞出，最后被移除。

**Q: 为什么第一个方块不动？**  
A: 第一个方块是底座，固定不动作为基础。

**Q: 可以重新开始吗？**  
A: 可以，游戏结束后点击"再玩一次"按钮。

### 已知限制
- 无暂停功能
- 无撤销功能
- 无音效和背景音乐
- 无在线排行榜
- 无多人对战模式
- 无成就系统
- 无关卡模式

### 性能优化建议
- 使用现代浏览器
- 启用硬件加速
- 关闭不必要的标签页
- 避免在低性能设备上长时间游戏
- 定期清理浏览器缓存

### 未来改进方向
- 🎵 添加背景音乐和音效
- ⏸️ 添加暂停功能
- 🎨 多种方块皮肤和主题
- 🏆 在线排行榜
- 📊 详细统计数据
- 🎯 成就系统
- 🎮 多种游戏模式（计时、限定楼层等）
- 💾 游戏回放功能
- 📱 PWA 支持（离线游戏）
- 🌐 多语言支持
- 🎁 道具系统（减速、稳定等）
- 👥 多人竞速模式

---

**准备好建造最高的塔了吗？开始游戏吧！** 🏗️🎮✨
