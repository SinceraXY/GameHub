# 🧩 华容道 | Klotski

移动滑块，解救曹操！

## 📖 游戏简介

华容道（Klotski）是中国传统的益智游戏，也是世界著名的滑块谜题之一。游戏的目标是通过移动棋盘上的其他滑块，为红色的"曹操"块开辟通往底部出口的道路。游戏提供4个精心设计的关卡，从简单到专家难度递增，支持撤销、提示功能和进度保存，挑战你的空间思维和策略规划能力！

### 游戏特色
- **4个经典关卡**：横刀立马、近在咫尺、守口如瓶、兵挡将阻
- **四种难度**：简单、中等、困难、专家
- **智能提示**：根据曹操位置给出策略建议
- **撤销功能**：支持逐步回退操作
- **方向选择**：多方向可移动时显示方向指示器
- **进度保存**：自动保存最佳步数记录
- **视觉效果**：粒子特效、移动动画、胜利闪烁
- **音效系统**：移动、胜利、提示音效

## 🎮 游戏玩法

### 基本操作

**移动滑块**：
1. 点击一个滑块
2. 如果只有一个可移动方向→自动移动
3. 如果有多个可移动方向→显示方向指示器
4. 点击方向指示器（黄色圆形箭头）选择移动方向

**撤销操作**：
- 点击"↶ 撤销"按钮
- 返回上一步状态
- 步数相应减少

**重置关卡**：
- 点击"🔄 重置"按钮
- 恢复当前关卡初始状态
- 步数和时间重置

**查看提示**：
- 点击"💡 提示"按钮
- 高亮显示曹操位置
- 显示策略建议

**切换关卡**：
- 点击"📋 关卡"按钮
- 在弹窗中选择关卡
- 查看完成状态和最佳记录

### 游戏规则

#### 游戏目标

**胜利条件**：
- 将红色的"曹操"块移动到底部出口位置
- 出口位置：棋盘底部中间（坐标 x=1, y=3）
- 曹操成功到达出口即通关

#### 棋盘布局

**棋盘尺寸**：
- 宽度：4格
- 高度：5格
- 出口：底部中间2格宽的位置

#### 滑块类型

**🔴 曹操（红色）**：
- 尺寸：2×2（最大的块）
- 目标：移动到出口
- 特点：红色渐变，脉冲动画

**🟢 关羽（绿色）**：
- 尺寸：1×2（竖直）
- 类型：大将
- 特点：绿色渐变

**🔵 武将（蓝色）**：
- 角色：张飞、赵云、马超、黄忠
- 尺寸：1×2（竖直）
- 特点：蓝色渐变

**🟡 兵卒（黄色）**：
- 尺寸：1×1（最小的块）
- 数量：2-4个（根据关卡）
- 特点：黄色渐变

#### 移动规则

**合法移动**：
- 只能移动到相邻的空位
- 移动方向：上、下、左、右
- 不能越过或穿透其他滑块
- 不能超出棋盘边界

**方向选择**：
- 单方向可移动：点击直接移动
- 多方向可移动：显示方向指示器
- 点击指示器选择移动方向
- 点击已选中的块：取消选择

**无法移动**：
- 四周被其他滑块包围
- 无相邻空位
- 显示"❌ 此块无法移动！"提示

### 四个关卡

**关卡1：横刀立马（简单）**：
- 难度：简单
- 最少步数：81步
- 布局：曹操居中，关羽在下方，两侧武将，2个兵卒

**关卡2：近在咫尺（中等）**：
- 难度：中等
- 最少步数：100步
- 布局：曹操左上，关羽右侧，4个兵卒在底部

**关卡3：守口如瓶（困难）**：
- 难度：困难
- 最少步数：120步
- 布局：曹操居中，关羽左侧，4个兵卒中间形成瓶颈

**关卡4：兵挡将阻（专家）**：
- 难度：专家
- 最少步数：150步
- 布局：曹操偏下，4个兵卒在顶部阻挡

### 统计系统

**⏱️ 时间**：
- 格式：MM:SS
- 从开始游戏后计时
- 完成后停止

**🎯 步数**：
- 每次移动滑块 = 1步
- 撤销会减少步数
- 完成后显示总步数

**🏆 最佳步数**：
- 显示当前关卡的最佳记录
- 自动保存在localStorage
- 新纪录时显示"🏆 新纪录！"

**📋 关卡进度**：
- 已完成：紫色渐变卡片
- 当前关卡：黄色边框高亮
- 未完成：灰色卡片

### 提示系统

**智能提示**（根据曹操位置）：

**曹操 y < 3**（未到达底部）：
- 提示："尝试移动其他块，为曹操腾出向下的空间！"
- 建议：
  - 先移动兵卒创造空间
  - 利用武将进行周转
  - 注意保持通往出口的路径

**曹操 x ≠ 1**（未居中）：
- 提示："曹操需要移动到中间位置！"
- 建议：
  - 清理两侧的障碍物
  - 保证中间有足够空间
  - 左右移动需要策略

**曹操接近出口**：
- 提示："曹操已经很接近出口了，继续加油！"
- 建议：
  - 再往下移动一格
  - 确保下方有空间
  - 胜利就在眼前！

## 🖥️ 界面说明

### 游戏头部
- **标题**："🧩 华容道"（渐变动画）
- **副标题**："Klotski - 移动滑块，解救曹操！"

### 信息栏（4项）

1. **难度**：
   - 显示：简单/中等/困难/专家
   - 紫色渐变背景

2. **步数**：
   - 实时更新
   - 移动时缩放动画

3. **时间**：
   - 格式：MM:SS
   - 每秒更新

4. **最佳**：
   - 显示最佳步数
   - 未完成显示："--"

### 游戏板

**棋盘样式**：
- 尺寸：400×500px（桌面）
- 背景：棕色木纹渐变
- 边框：深棕色，4px
- 纹理：斜线重复图案

**出口标记**：
- 位置：底部中间
- 样式：红色虚线边框
- 标签："出口"（红色圆角）

**滑块显示**：
- 圆角：8px
- 阴影：立体效果
- 文字：滑块名称
- 悬停：放大1.05倍

### 滑块状态

**默认状态**：
- 根据类型显示颜色
- 渐变背景
- 立体阴影

**悬停状态**：
- 放大1.05倍
- 增强阴影
- z-index提升

**选中状态**（多方向时）：
- 黄色边框（3px）
- 黄色光晕
- 脉冲动画

**移动动画**：
- 缩放效果（1 → 1.15 → 1）
- 0.3秒平滑过渡
- 粒子特效（5个粒子）

**曹操特殊效果**：
- 持续脉冲动画
- 旋转光晕
- 红色波纹扩散

### 方向指示器

**显示时机**：
- 滑块有多个可移动方向时
- 点击滑块后出现

**指示器样式**：
- 形状：圆形（40px直径）
- 颜色：黄色渐变
- 内容：方向箭头（↑↓←→）
- 位置：滑块周围
- 动画：缩放出现 + 浮动

**交互效果**：
- 悬停：放大1.2倍
- 点击：执行移动
- 自动消失：移动后

### 控制按钮（4个）

1. **🔄 重置**：
   - 恢复关卡初始状态
   - 紫色渐变

2. **↶ 撤销**：
   - 返回上一步
   - 紫色渐变

3. **💡 提示**：
   - 显示策略建议
   - 高亮曹操

4. **📋 关卡**：
   - 打开关卡选择弹窗
   - 紫色渐变

### 游戏说明

**🎯 游戏目标**：
- "移动红色的'曹操'块到底部出口位置即可过关！"

**🎮 操作方式**：
- "点击滑块即可移动到相邻的空位"

### 开始遮罩

**显示时机**：游戏加载时

**内容**：
- 标题："🧩 华容道"
- 副标题："经典益智滑块游戏"
- "开始游戏"按钮（紫色）
- 难度选择（4个按钮，2×2布局）

### 关卡选择弹窗

**触发方式**：点击"📋 关卡"按钮

**关卡卡片**（4个，4列布局）：
- **关卡编号**：1-4
- **关卡名称**：横刀立马、近在咫尺、守口如瓶、兵挡将阻
- **难度标签**：简单/中等/困难/专家
- **最佳记录**：已完成显示步数，未完成显示"未完成"

**卡片状态**：
- 未完成：灰色渐变
- 已完成：紫色渐变 + 白色文字
- 当前关卡：黄色边框高亮

### 胜利弹窗

**显示时机**：曹操到达出口位置

**特效**：
- 曹操闪烁6次
- 30个彩色粒子爆发
- 胜利音效（三音符）

**弹窗内容**：
- 标题："🎉 恭喜过关！"
- 统计信息（4项）：
  - 关卡编号
  - 步数
  - 用时
  - 新纪录提示（创纪录时显示）
- 两个按钮：
  - "下一关"（紫色）
  - "重玩"（灰色）

## 🎨 视觉效果

### 配色方案
- **主色调**：紫色（#667eea）
- **次色调**：深紫（#764ba2）
- **曹操**：红色（#FF4444）
- **关羽**：绿色（#22BB33）
- **武将**：蓝色（#4A90E2）
- **兵卒**：黄色（#FFD93D）
- **棋盘**：棕色（#8B7355）

### 动画效果

1. **渐变动画**（gradientShift）：标题文字
2. **脉冲动画**（pulse）：曹操块
3. **光晕旋转**（shine）：曹操内部
4. **移动动画**（moveEffect）：滑块移动时
5. **方向指示器**（indicatorFloat）：浮动效果
6. **闪烁动画**：胜利时曹操
7. **粒子系统**：移动和胜利特效

### 粒子特效

**移动特效**：
- 数量：5个粒子
- 颜色：根据滑块类型（曹操红色，其他紫色）
- 运动：随机方向 + 重力
- 生命周期：50帧

**胜利特效**：
- 数量：30个粒子
- 颜色：红、黄、绿三色
- 延迟生成：每20ms一个
- 爆炸效果

### 音效系统

**移动音效**：
- 频率：400Hz
- 类型：正弦波
- 时长：0.1秒

**胜利音效**：
- 三个音符：523Hz、659Hz、784Hz
- 间隔：0.15秒
- 时长：0.3秒/音符

**提示音效**：
- 频率：600Hz
- 类型：三角波
- 时长：0.2秒

**音效开关**：
- 双击标题切换
- 显示提示："🔊 音效已开启" / "🔇 音效已关闭"

## 📱 响应式支持

### 桌面（> 768px）
- 棋盘：400×500px
- 信息栏：4列
- 控制按钮：4列
- 关卡网格：4列

### 平板/手机（≤ 768px）
- 棋盘：最大320×400px
- 信息栏：2×2网格
- 控制按钮：2×2网格
- 关卡网格：3列

### 小手机（≤ 480px）
- 棋盘：最大280×350px
- 字体缩小
- 关卡网格：2列

## 🚀 快速开始

### 运行游戏
1. 在浏览器中打开 `index.html`
2. 选择难度（或使用默认普通难度）
3. 点击"开始游戏"
4. 点击滑块移动，解救曹操！

### 浏览器要求
- ✅ 支持 ES6 JavaScript
- ✅ 支持 CSS Grid
- ✅ 支持 Web Audio API
- ✅ 支持 localStorage
- ✅ Chrome / Edge / Firefox / Safari

## 💡 游戏技巧

### 基础策略

1. **分析初始布局**：
   - 观察曹操与出口的距离
   - 识别阻挡路径的关键滑块
   - 规划移动顺序

2. **空间管理**：
   - 利用兵卒创造空间
   - 兵卒灵活，可快速移动
   - 为大块滑块腾出空间

3. **周转策略**：
   - 利用武将进行位置周转
   - 大块移动需要更多空间
   - 提前规划移动路线

4. **逆向思维**：
   - 从出口反推所需布局
   - 确定哪些块需要移开
   - 制定清理路径的步骤

### 进阶技巧

**利用空位**：
- 记住空位的位置
- 空位是移动的关键
- 2个空位可进行更复杂操作

**最小化移动**：
- 避免无效移动
- 每步都朝目标前进
- 减少来回移动

**分步骤思考**：
- 第一步：清理曹操左右两侧
- 第二步：清理曹操下方通道
- 第三步：将曹操移到中间
- 第四步：向下移动至出口

**使用撤销**：
- 走错路立即撤销
- 尝试不同路线
- 找到最优解

### 各关卡攻略提示

**横刀立马（简单）**：
- 先移动底部兵卒
- 为关羽腾出横向空间
- 逐步向下推进

**近在咫尺（中等）**：
- 曹操在左上，需移到右下
- 利用底部4个兵卒
- 关键是打开中间通道

**守口如瓶（困难）**：
- 中间4个兵卒形成瓶颈
- 需要复杂的周转
- 注意两侧武将的配合

**兵挡将阻（专家）**：
- 顶部4个兵卒阻挡
- 需要大量步骤清理
- 考验全局规划能力

## 🏆 挑战目标

### 完成挑战
- 🥉 **新手**：完成关卡1
- 🥈 **熟练**：完成关卡2
- 🥇 **高手**：完成关卡3
- 💎 **大师**：完成关卡4

### 步数挑战
- 🥉 **新手**：< 最少步数 × 2
- 🥈 **熟练**：< 最少步数 × 1.5
- 🥇 **高手**：< 最少步数 × 1.2
- 💎 **完美**：= 最少步数

### 速度挑战
- ⚡ **关卡1**：< 5分钟
- ⚡ **关卡2**：< 8分钟
- ⚡ **关卡3**：< 12分钟
- ⚡ **关卡4**：< 15分钟

## 🔧 技术细节

### 碰撞检测

```javascript
function blocksOverlap(x1, y1, w1, h1, x2, y2, w2, h2) {
  return !(x1 + w1 <= x2 || x2 + w2 <= x1 || 
           y1 + h1 <= y2 || y2 + h2 <= y1);
}
```

### 可移动检测

```javascript
// 四个方向
const directions = [
  { dx: 0, dy: -1, dir: 'up' },
  { dx: 0, dy: 1, dir: 'down' },
  { dx: -1, dy: 0, dir: 'left' },
  { dx: 1, dy: 0, dir: 'right' }
];

// 检查边界和碰撞
if (newX >= 0 && newY >= 0 && 
    newX + block.width <= 4 && 
    newY + block.height <= 5 &&
    !hasCollision) {
  // 可以移动
}
```

### 胜利判定

```javascript
// 曹操到达出口位置
if (caocao.x === 1 && caocao.y === 3) {
  win();
}
```

### 历史记录

```javascript
// 保存当前状态（深拷贝）
moveHistory.push(JSON.parse(JSON.stringify(LEVELS[currentLevel].blocks)));

// 撤销（恢复上一状态）
const previousState = moveHistory.pop();
LEVELS[currentLevel].blocks = JSON.parse(JSON.stringify(previousState));
```

### 进度保存

```javascript
// 保存
localStorage.setItem('klotskiProgress', JSON.stringify(levelProgress));

// 读取
const saved = localStorage.getItem('klotskiProgress');
levelProgress = JSON.parse(saved);
```

## 🐛 反馈与支持

### 常见问题

**Q: 如何移动滑块？**  
A: 点击滑块，如果有多个方向可移动会显示方向指示器，点击指示器选择方向。

**Q: 什么是出口位置？**  
A: 棋盘底部中间的位置，用红色虚线标记，标签显示"出口"。

**Q: 为什么有的滑块点击后没反应？**  
A: 该滑块四周被其他块包围，无空位可移动。

**Q: 如何查看最佳步数？**  
A: 信息栏右上角显示当前关卡的最佳记录。

**Q: 撤销有次数限制吗？**  
A: 没有限制，可以一直撤销到初始状态。

**Q: 如何切换关卡？**  
A: 点击"📋 关卡"按钮，在弹窗中选择关卡。

**Q: 最少步数是什么？**  
A: 理论上完成该关卡所需的最少移动次数，非常难达到。

**Q: 如何关闭音效？**  
A: 双击标题"🧩 华容道"可切换音效开关。

**Q: 进度会自动保存吗？**  
A: 是的，最佳步数会自动保存在浏览器localStorage中。

**Q: 方向指示器是什么？**  
A: 当滑块有多个可移动方向时，显示的黄色圆形箭头按钮。

### 已知限制
- 无解法提示（仅提供策略建议）
- 无自动求解功能
- 无步数回放
- 仅4个预设关卡

### 性能优化建议
- 使用现代浏览器
- 游戏轻量级，无特殊要求

### 未来改进方向
- 🎯 更多关卡
- 💡 逐步解法提示
- 📊 详细统计图表
- 🎨 自定义主题
- 👥 解法分享
- 🏅 成就系统
- 📱 触屏拖拽支持
- 🎵 更丰富的音效
- 🔢 自定义布局编辑器
- 📖 解法回放功能

---

**准备好挑战华容道了吗？开始游戏吧！** 🧩🎯✨
